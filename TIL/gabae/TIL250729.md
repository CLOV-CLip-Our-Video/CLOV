# TIL 250729

## 오늘 한 일 : 프로젝트 관련
- WebRTC..를 위한 다양한 일들
    - SDP, ICE candidate가 클라이언트 간 P2P 연결을 위한 핵심 요소라는 걸 학습
    - 이를 바탕으로 SDP Offer/Answer 및 ICE Candidate 메시지를 WebSocket으로 중계하는 백엔드 로직 구현 완료
    - sdp, iec라는 게 필요하다는걸 알았음...그래서 클라이언트 간 WebRTC 연결을 위해 SDP Offer/Answer 및 ICE Candidate 메시지를 WebSocket으로 중계하는 로직 구현 완료
    
    - 프론트 예시 코드 주기 위해서 다양한 작업을 함...
        - WebRTC 연결 흐름(PeerConnection, 트랙 연결 등) 확인 및 정리
        - user-joined, canvas-sync 등 주요 이벤트 처리 프론트쪽에서 어떻게 하면 좋을지 코드 짜기 완료
        - 공개 STUN 서버(stun.l.google.com) 사용하여 NAT 환경에서도 ICE candidate 확보 테스트 완료
        - 마우스 드래그로 비디오 위치 조정 가능하도록 Canvas 내 드래그 로직 구현 이것도 완료
        - P2P 구조가 다자간에서도 연결되도록 App.js 내부 연결 시퀀스 테스트 및 개선 이것도 완료...꽤나..대단해...
        - 이제 된다...비디오 뜨는거 ㅠㅠ유유ㅠㅠ유ㅠㅠ유 프론트 팀원들...제가 열심히했사와요...


## 오늘 배운 것, 고민
- WebRTC 연결에는 시그널링 과정이 필수라는 것을 이해함
    - SDP(offer/answer), ICE candidate를 교환해야만 실제 미디어 스트림 연결이 이루어짐
    - 이 과정은 WebRTC 내부가 아니라 직접 구현한 WebSocket 시그널링 서버를 통해 처리해야 한다는 것을 알게 됨

- 참가자 간 양방향 연결 로직 고민
    - 누가 offer를 보내고 누가 answer를 받는지 결정하는 흐름을 구현하며 중복 연결 방지 로직을 고민함
    - 특히 새로운 참가자가 입장할 때 기존 참가자들과의 P2P 연결을 어떻게 안전하게 맺을지 고려해야 했음

- P2P 구조의 확장 한계 고민
    - 방당 4명까지는 성능상 문제 없지만, 그 이상이 되면 브라우저 성능 저하 발생 가능
    - 장기적으로는 SFU(SFU Gateway) 도입을 고려해야 할 수도 있다는 점을 인지함
    - 근데 4명 정도로 그냥 확정하면 굳이..? 이건 얘기해봐야할듯

- WebRTC에서 영상(P2P 비디오/오디오) 연결을 위해 https 또는 localhost가 사실상 필수..
    - 근데 아까 안 됐던 코드가 갑자기 왜 되는건지요...그때도 localhost였는데..(?)
    - 아무튼 우리는 이후에 https에서 무조건해야해서 예시 코드 구현도 그렇게 함.

- 몰랐는데..오늘 내가 한 구현이 WebRTC 직접 구현이었음..RTCPeerConnection, getUserMedia, onicecandidate, setLocalDescription, setRemoteDescription 이런거 사용했는데, 이런거 쓰면 난 직접 구현이 아닌 줄 알았음..바보...
    - 상태 관리, offer/answer/candidate 교환, 스트림 연결 모두 수작업으로 처리함...!ㅠ유유ㅠ유 수고했따따

## 내일 할 일
- 프론트에게 코드 주고 프로젝트에 적용 도와주기
- TTL 만료 처리(이건 근데 이후에 할까 고민 중 테스트하면서 30분이 넘어가는데 만료돼서 사라지면 다시 방 파고 해야돼서 귀찮..)
- 영우 오빠가 말했던 isHost를 leave-room event에 포함시켜서 업로드
- sfu, p2p 등.. 찾아봤는데 이와 관련해서 우리 방 최대 인원 몇 명할지 논의