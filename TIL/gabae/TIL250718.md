# TIL 250718

## 오늘 한 일 : 프로젝트 관련
- 당장 필요한 역할 분담 완료
    - 은재가 ec2, rds 안해봐서 해보고싶다해서 맡기고(굿!) + 백엔드는 배경쪽 담당
    - 예린이랑 나랑은 방, Canvas 각각 나눠서 api 담당
- ec2, rds 만들었던거 나도 까먹을까봐 어떻게 전에 프로젝트에서 만들었었는지 기록했던 문서있었는데 그걸로 복습(?)함
- Redis를 활용한 Canvas 상태 저장 구조 및 Repository 구현
- RedisCanvasRepository 기능 테스트
    - 캔버스 상태(CanvasStateDto)를 Redis에 저장 및 조회 완료
- RedisConfig에서 RedisTemplate의 직렬화 방식을 커스터마이징함
    - Key, HashKey: StringRedisSerializer
    - Value, HashValue: GenericJackson2JsonRedisSerializer
- 공통된 응답이나 에러처리 등의 코드가 필요하다고 논의 완 -> 예린이 프젝에서 쓰던 코드로 설정완~~~
    - 이거 이용해서 응답 처리
- Canvas 상태 동기화 API (PUT) 구현,Canvas 전체 상태 조회 API (GET) 구현 완료
    - API 테스트를 아직 못해봐서 커밋 안함
## 오늘 배운 것, 고민
### Redis 직렬화 전략

- RedisTemplate 직렬화 설정 시, JSON 기반 Value 직렬화는 GenericJackson2JsonRedisSerializer를 사용하는 것이 더 안전하고 간편함
- GenericJackson2JsonRedisSerializer의 주요 장점

| 항목                     | 설명                                                                 |
|------------------------|----------------------------------------------------------------------|
| 타입 정보 포함 자동 처리 | 내부적으로 `@class` 필드를 통해 타입 정보를 저장하므로 다형성 객체 처리에 유리 |
| ObjectMapper 설정 불필요 | `setObjectMapper()` 없이도 사용 가능하며 Jackson 3 대응에도 안전            |
| 간결함                   | 복잡한 `activateDefaultTyping` 설정 없이도 작동                        |
| Spring 공식 추천         | Spring Data Redis에서 권장되는 직렬화 방식 중 하나                        |

- 반면, Jackson2JsonRedisSerializer<Object>는 setObjectMapper() 설정이 필요하며, 해당 메서드는 Jackson 3 이상에서 deprecated 예정이라 장기적으로 비추천이라는걸 알아냄

### DTO 설계 시 Wrapper 타입(Boolean, Long 등) 사용 이유

- DTO 필드에 boolean, long 같은 기본형이 아닌 Boolean, Long과 같은 Wrapper 타입을 사용하는 것이 더 유연함
- **null 가능성**을 허용하여 초기화되지 않은 상태, 선택적 필드, 클라이언트 미전송 값 등을 명확히 표현할 수 있음
- 특히 Redis나 JSON 직렬화 환경에서는 `null` 상태를 표현할 수 있어야 하므로 Wrapper 타입이 더 적합
- 참고 : https://0soo.tistory.com/121

### OffsetDateTime vs LocalDateTime
- 은재의 고민...같이 해봄...!시간 필드 타입 결정 시 `OffsetDateTime`과 `LocalDateTime`을 비교 고민했으며, 타임존 정보가 필요한 경우 `OffsetDateTime`이 더 적합하다는 점을 고려

### hostId, ClientId
- 예린이의 api 고민 : 방 생성 시 host를 자동으로 참여자로 등록하는 흐름
- 같이 고민해본 결과
    - 방 생성 시 host의 clientId를 생성하고, 해당 값을 기반으로 Room을 생성한 후 RoomParticipant에도 자동 등록되도록 흐름 설계
    - 방장(clientId)은 곧 hostId이며, 방 생성과 동시에 참여자 목록에 추가됨으로써 별도 참여 API 호출 없이도 참여 상태 유지
    - cf) erd설계에는 방참가자 목록에 isHost 안 넣었었는데 필요할까?

## 내일 할 일
- Canvas 상태 저장/조회 기능 마무리 및 테스트
- Redis TTL 및 만료 처리 전략 설계
- WebSocket 연동 시 상태 변경 동기화 방식 검토