# TIL 250724

## 오늘 한 일 : 프로젝트 관련
- WebSocket, Redis Pub/Sub 코드 진짜 완성...
- Redis Pub/Sub 구성 및 메시지 흐름 개선
    - RedisPubSubConfig에서 PatternTopic("room:*")을 구독하도록 설정하여, 특정 roomCode의 이벤트를 유연하게 수신할 수 있게 개선함.
    - 메시지 수신은 RedisSubscriber에서 처리하며, RoomStateWebSocketHandler를 통해 WebSocket 클라이언트에 브로드캐스트함.
    - 브로드캐스트 시, 자신이 보낸 메시지를 제외하고 전송하는 처리는 현재는 프론트에서 클라이언트가 필터링하거나, 서버에서 clientId를 활용해 구분 가능하다는 구조로 이해됨.
    - WebSocket 메시지 흐름 및 설계 정리
        - 클라이언트 → 서버: join-room, update-position, start-recording 등의 이벤트를 전송

        - 서버 → Redis: 해당 이벤트를 publish

        - Redis → RedisSubscriber → 서버 내 WebSocketHandler: 메시지를 받아 브로드캐스트 수행
    - 내일 DTO 조금 리팩토링 예정
- Redis Pub/Sub 공부, WebSocket 공부

## 오늘 배운 것, 고민
- WebSocket 메시지에서 자기 자신 제외 브로드캐스트는 보통 서버보단 클라이언트 필터 방식이 일반적이며, 불필요한 복잡도와 성능 이슈를 고려해야 함.

- STOMP가 아닌 커스텀 WebSocket + Redis Pub/Sub 조합으로 설계된 구조에서의 메시지 흐름과 분기처리는 명확하게 서버/클라이언트 역할을 나눠야 유지보수가 쉬움.

- Redis key 패턴을 일관되게 구성한 점이 전체 아키텍처에서 중요한 역할을 함.

- 배운거 많은데...다시 남기겠음...
## 내일 할 일
- WebSocket 통신 프로토콜 정의 문서 작성 (프론트에게 전달할 이벤트 포맷 및 흐름 문서)
- 웹소켓 DTO 개선
- 모니터링 도구 공부 운영 방안 공부