# TIL 250725

## 오늘 한 일 : 프로젝트 관련
- WebSocket, Redis Pub/Sub 코드 진짜 완성이 어제인줄 알았는데...흑흑 고칠게 남았었다
    - 웹소켓 이벤트 각각 구조 어떻게 가져갈지 고민 끙끙 -> 팀원들한테 계속 물어보면서 뭐가 좋냐고 확인!!!
    - 웹소켓 이벤트 분기 처리 구현해놓음!
    -  캔버스 상태 동기화 5초 주기 full sync + delta mix 구조 채택
        - full sync는 스케줄러 구현(나중에 유저가 엄~~~청 많아져서 방 개수가 많아지면 부담이 가겠지만..)
            - 나중에 부담이 간다면 병렬 처리나 분산처리(kafka) or 비동기 큐 고려...(지금은 적용하기엔 오버엔지니어링같음..)

- WebSocket 이벤트 명세 작성
    - join-room, user-joined, update-position, position-updated, canvas-sync, start-recording, start-photo, countdown-start, leave-room, user-left

- For 프론트.. 소켓 연결 기본 및 예제 코드 워크북 제작

- WebSocket 테스트 자동화 코드 작성

tmi..sqlp를 신청하고 싶었는데 b형 일정이랑 겹쳐서 내년에 보기로함..끙....ㅠㅠㅠ

## 오늘 배운 것, 고민
- redis...환경 변수로 설정할 때는 되고...그냥 하면 안 되는 이유.....아직 못 찾음..알고싶다..
- 예린이의 db연결 문제 : [Spring Boot] Access denied for user 'root'@'localhost'(using password: yes)
    - DataGrip에서는 연결되는데 yml파일 설정해줘도 위와 같은 에러가 뜬다고해서 같이 찾아봐줬다
    - 예린이의 로컬 mysql 비번이 다 숫자로면 되어있었는데 이렇게 되면 숫자로 인식해서 안되는거였다...string 으로 인지할 수 있게 single quote 를 붙여 코드를 수정하니까 잘 된다고함 굿!!
        -참고: https://atsky.tistory.com/67
    - redis-cli로 키 뭐 들어갔는지 확인하면서 하는데 갑자기 keys *;했는데 (empty array)해서 왜 !!!!!했는데 ';'붙여서 그런거였음 sql...생각하다가..머쓱
        - keys * 이렇게 해야함...바보...
    - OT (Operational Transform)/CRDT (Conflict-Free Replicated Data Type)에 대해 알게됨
        - 지금 구조에서는 이거 없음..!즉, 여러 사용자의 동시 상태 변경 충돌을 자동으로 해결해주는 처리는 아직 없음.
        - 서버가 마지막 상태만 덮어씌우고 있고, 어떤 순서로 들어온 값이 우선인지 안 따짐
        -  A와 B가 동시에 같은 객체를 움직였을 경우, 뒤에 온 메시지가 최종 상태가 됨
            - 이건 완전한 OT/CRDT는 아니고, 그냥 “Last Writer Wins (LWW)” 방식...
        - 필요해지면 적용할 예정..공동 객체를 조작한다거나...첫 번째 배포에서는 공동 객체 조작이 아니라 자기 자신만 조작 가능하기 때문..
    - ws:// vs wss:// (웹소켓한지 오래돼서 이걸 까먹고 있었음.....다시 기억하자...)
        - ws://
            - 일반 WebSocket (비보안, 개발 환경에서만 사용)
        - wss://
            - 보안 WebSocket (TLS/SSL 적용, HTTPS와 연동 시 필수)
    - Nginx 리버스 프록시를 사용한다면, WebSocket 업그레이드 설정도 포함해야한다는데 이건 아직 적용안함

    - NoSql과 RDBMS와는 역할에 차이가 일반적인 수준에서 존재
        - 아무래도 변화가 빠르며 즉각적인 Return이 필요한 영역에서 NoSQl을 사용
        - 회사 자산으로 활용하며 복잡하고 대용량의 Data가 필요한 영역에서는 RDBMS를 선호
        - Index라는 개념이 clusterd를 제외하고는 선택적이다 보니 RDBMS에서의 사용에 초점을 두고 있고 그편으로 우선 적용
    

## 내일 할 일
- 프론트 연동 도움
- 모니터링 도구 검색
- 또 뭐해야할까..
- 아 Redis의 Keyspace Notification으로 만료 이벤트를 받아 자동으로 Room 삭제..안했다..이거 해야지..