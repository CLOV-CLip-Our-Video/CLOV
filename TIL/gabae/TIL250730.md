# TIL 250730

## 오늘 한 일 : 프로젝트 관련
- 캔버스 위에서 마우스로 이동하고, 영상 띄워지는거 테스트하는거…예시 코드 zip파일과 기능능 별로 나눠서 문서화
- 3명의 WebRTC 연결 과정으로 흐름을 이해해봅시다… (sdp offer, ice candidate, sdp answer, sturn 서버, p2p 연결..원격스트림..)이라는 문서 작성
    - 프로젝트에 적용하는 가이드 제공
    - 결국 이걸로 밤에 팀원들끼리 으쌰으쌰해서 webrtc 성공!
- 공인 IP와 사설 IP 문서 작성
- P2P vs SFU vs MCU 문서 작성
- HTTP 상태 코드 정리 문서 작성
- 프론트쪽 요청 반영
    - 웹소켓 이벤트 중 update-state, state-updated, canvas-sync에 mode와 filter추가
    - 웹소켓 이벤트 중 user-left에 isHost 정보 추가하기
    - 수정 내용 웹소켓 이벤트 명세서에 반영
- 방만료를 위해 redis.conf에서 Keyspace Notification 활성화
    - 아직 백엔드쪽 로직은 안 짬.(for 테스트..)


## 오늘 배운 것, 고민
- 무료 STUN 서버가 있는데 개발하면서 테스트할 때 모바일 LTE환경에서 접속한 사용자와 랜선 사용자 간 P2P 연결이 되지 않았다.
- 뭘까 싶었는데
- STUN 서버는 NAT을 통과하는 클라이언트 장치의 공인 IP주소와 포트를 확인하고 이를 활용해 클라이언트 간 연결을 수행할 수 있게 도와준다.
    - 어떤 종단이 NAT/Firewall 뒤에 있는지를 판단하게 해준다.
    - 어떤 종단에 대한 Public IP Address를 결정하고 NAT/FIrewall의 유형에 대해서 알려준다.
- NAT(Network Address Translation) : 인터넷 같은 공용 네트워크에서 사설 네트워크를 사용하기 위한 기술
- 그래서 결론..
-  STUN 서버만으로 안되는 이유는 NAT의 변환 방식이 다양하고 동적이여서 통신에 사용되는 public ip가 늘 같지 않다는 것이다.
    - 따라서 앞서 공인 IP와 포트를 확인해 연결시킨다는 역할을 하는 STUN서버만으로는 연결이 확실하지 않을 수 있다는 결론을 얻었다.
    - 더 찾아보니 기업 네트워크, 공용 와이파이 등에서 Symmetric NAT을 주로 사용하고
    - 모바일 네트워크 같은 경우도 동적으로 할당되는 공인 IP주소를 활용한다고 한다.
    - 공인 IP주소가 동적으로 바뀌는 경우 STUN서버에 제대로 전달되지 않거나 이전에 수집한 NAT정보와 매칭되지 않게되어 잘못된 정보를 전달할 수 있다고 하며
    - 그 외에도 네트워크의 방화벽 문제로 STUN서버를 통해 연결할 수 없는 상황이 있다고 한다.
- 그래서 turn서버가 필요하다고 한다
- TURN 서버는 클라이언트 서버 간 데이터 전송을 중계한다.
- STUN은 NAT 뒤의 공인 IP주소를 알아내 클라이언트끼리 이를 활용해 연결할 수 있도록 중계하는 역할을 했다면
- TURN은 데이터를 중계해준다.
- 따라서 공인IP가 변경되어도 중계서버인 TURN을 통해 데이터를 주고받을 수 있게 해준다.
- TURN서버는 하나의 공인 주소를 가지고 있고 이 주소를 통해 클라이언트들이 직접적으로 미디어를 릴레이하기 때문에 네트워크와 컴퓨팅 자원이 소모된다.

- 시간이 안된다면 배포 먼저 하고 이후에 TURN서버를...만들고... 시간이 난다면 틈날 때 해놔야겠다...

- 생각보다 배포 일정이 밀렸는데...오늘 컨설턴트님께서 릴리즈 블로킹을 빠르게 해소해야한다고 하셨다.
    - 이를 위해 계속 서로 노력하고 있었는데, 오늘 컨설턴트님 말씀을 듣고 더 으쌰으쌰해서 프론트 코드를 같이 봤다.
    - 결국 성공!! 해냄!!

## 내일 할 일
- 모니터링 관련해서 대시보드 다 만들기
- 장표 제작
- 이제는...우리 서비스를..세상에 진짜 공개...진짜...진짜.................눈물..