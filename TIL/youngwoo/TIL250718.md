# TIL - 2025년 7월 18일

## 모달 연동

### Modal import 경로 오류 해결

- `Header.jsx`에서 `Modal.jsx`를 불러올 때 정확한 파일 경로로 지정해야 함
  ```tsx
  import Modal from "../Modal/Modal"; // 정확한 파일 경로
  ```
- 그냥 `../Modal`로만 작성하면 디렉토리까지만 접근되고, 실제 파일이 import되지 않아 오류 발생

### 오늘 배운 것 정리

- `<> </>`는 React Fragment로, 불필요한 `<div>` 없이 요소를 묶을 수 있음
- `fixed`는 요소를 화면에 고정하지만, 다른 요소를 아래로 밀지 않으므로 `padding`을 따로 줘야 함
- Tailwind의 `z-50`, `shadow`, `bg` 등을 조합하면 자연스러운 고정형 헤더 UI 구성 가능
- 공통 컴포넌트(`Modal`)는 다른 컴포넌트에서 import해서 재사용 가능하게 설계해두는 것이 편함
- `import` 시 경로는 반드시 **정확한 파일 위치까지 명시**해야 한다 (`../Modal/Modal`)

### 1. ESC 키가 모달에서 바로 작동하지 않는 이유

- `onKeyDown`은 해당 DOM 요소가 포커스를 가지고 있어야 작동함
- `tabIndex=0`을 줬지만, 자동으로 포커스되지 않아서 ESC 이벤트가 안 먹힘
- 모달 내부를 한 번 클릭해야 포커스가 생기기 때문에 그제서야 ESC가 작동

### 2. 해결 방법

- `useRef` + `useEffect`로 모달이 열릴 때 `.focus()`를 자동으로 줌

```jsx
const modalRef = useRef(null);

useEffect(() => {
  if (isOpen && modalRef.current) {
    modalRef.current.focus();
  }
}, [isOpen]);
```

### 3. 접근성 설정 관련 정리

- `tabIndex=0`: 포커싱 가능하게 설정
- `role="dialog"`: 보조 기술이 다이얼로그로 인식하도록 힌트
- `aria-modal="true"`: 모달 상태임을 명시 (보조기술 전용)

## 오늘 배운 핵심 주제: 전역 모달 구현 (React + Portal + Zustand)

---

### 1. `#modal-root`는 어디에 있어야 하는가?

```html
<body>
  <div id="root"></div>
  <div id="modal-root"></div>
  <!-- 포탈용 루트는 script 위에 위치해야 안전 -->
  <script type="module" src="/src/main.jsx"></script>
</body>
```

- `ReactDOM.createPortal()`은 부모 DOM 계층 **밖에 있는 노드에 렌더링**
- `modal-root`는 반드시 `#root` **외부**이자 `<script>` **위에** 있어야 함

---

### 2. Modal 컴포넌트 (`Modal.jsx`)

- props로 `isOpen`, `onClose`, `children` 받는 **로컬 모달 구조**
- 이미 Portal을 사용 중:

```jsx
return createPortal(modalContent, document.getElementById("modal-root"));
```

- 따라서 `#modal-root`에 정상적으로 렌더링됨

---

### 3. Portal로 렌더링되면 부모 DOM 안에 들어가는가?

- ❌ 아니다. 렌더링 위치는 항상 `#modal-root`
- 화면상 부모 컴포넌트와는 완전히 분리된 영역에 위치
- **z-index**, **transform**, **overflow: hidden** 등의 CSS 충돌에서 자유로움

---

### 4. 전역 모달이 필요한 경우는?

- 여러 페이지에서 **하나의 중앙 상태**로 모달을 컨트롤하고 싶을 때
- 예: 알림 모달, 확인 모달 등
- 이 경우 Zustand를 써서 다음과 같은 구조로 설계

```js
// store/modalStore.js
const useModalStore = create((set) => ({
  isOpen: false,
  content: null,
  openModal: (content) => set({ isOpen: true, content }),
  closeModal: () => set({ isOpen: false, content: null }),
}));
```

---

### 5. ModalRoot 컴포넌트 설계

```jsx
import ReactDOM from "react-dom";
import useModalStore from "@/store/modalStore";

export default function ModalRoot() {
  const { isOpen, content, closeModal } = useModalStore();

  if (!isOpen || !document.getElementById("modal-root")) return null;

  return ReactDOM.createPortal(
    <div className="fixed inset-0 bg-black/50 z-[9999]" onClick={closeModal}>
      <div className="modal-content">{content}</div>
    </div>,
    document.getElementById("modal-root")
  );
}
```

---

### 결론

- 기존 `Modal.jsx`는 지역 모달로 유지 가능
- 전역 모달이 필요해지면 Zustand + Portal 조합으로 확장
- Portal을 사용하면 **모달이 항상 부모 DOM 밖에 안전하게 렌더링됨**

### 1. Modal 컴포넌트의 포탈(Portal) 처리

- `createPortal`을 통해 모달을 `#modal-root`에 렌더링함으로써, DOM 계층 구조에 관계없이 UI를 일관되게 출력 가능.
- HTML 내 `#modal-root`가 필요함 (`public/index.html`에 `<div id="modal-root"></div>` 포함).

### 2. 현재 문제점

- `Header.jsx` 내부에서 모달 상태(`useState`)와 모달 컴포넌트를 직접 관리하고 있음.
- 이렇게 되면 Header에 불필요한 책임이 추가되며, 재사용성과 유지보수가 떨어짐.
- 포탈을 써도 모달 관리 책임이 분리되지 않으면 구조상 이점이 반감됨.

### 3. 개선 방향

- 모달은 전역에서 제어하는 구조로 설계 (e.g. `App.jsx` 또는 전용 `ModalProvider`)
- Header는 단순히 모달을 열기 위한 트리거 버튼만 담당.
- 모달의 내용과 상태는 전역 상태나 커스텀 훅으로 관리.

### 4. 예시 구조

```jsx
// App.jsx
<Header />
<ModalContainer />  // 전역 모달 상태로 포탈 포함

// Header.jsx
const { openModal } = useModalStore();
<button onClick={() => openModal(<ModalContent />)}>모달 열기</button>

// ModalContainer.jsx
const { isOpen, modalContent, closeModal } = useModalStore();
<Modal isOpen={isOpen} onClose={closeModal}>
  {modalContent}
</Modal>
```

### 5. 결론

- 현재처럼 `Header` 내부에서 모달 상태를 관리하는 것은 단기적으로는 간단하지만, 장기적으로 확장성/유지보수성이 낮음.
- Portal을 사용한다면 상태관리까지 완전 분리하는 구조가 진짜 이점을 살리는 길.

---

## 기타 학습

- `aria-label`, 접근성 고려한 버튼 마크업
- `twMerge` 활용한 Tailwind 클래스 병합
- 예/아니오 버튼 그리드 배치 (`grid-cols-2`)
- CSS 변수 기반 디자인 시스템 활용

---

## 정리

- Header는 트리거 역할만 하고, Modal은 독립된 포탈과 상태관리 시스템에서 관리하는 구조로 재설계 필요.
- 구조화된 전역 상태 기반 모달 설계를 적용할 수 있도록 준비.
