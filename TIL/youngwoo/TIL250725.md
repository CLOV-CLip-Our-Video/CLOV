# TIL - 2025년 7월 25일

## React Router의 useNavigate와 페이지 이동 처리

### 사용 상황

- `LandingPage`에서 방 생성/참여 후 `WaitingRoom`으로 이동
- 동의 모달 확인 후 자동으로 라우팅 처리
- 세션 스토리지를 활용한 상태 전달

### LandingPage.jsx에서 네비게이션 구현

```jsx
const LandingPage = () => {
  const navigate = useNavigate();
  const [showCreateConsent, setShowCreateConsent] = useState(false);
  const [showJoinConsent, setShowJoinConsent] = useState(false);

  const handleCreateClick = () => {
    sessionStorage.setItem("entryType", "create");
    setShowCreateConsent(true);
  };

  const handleJoinClick = async () => {
    if (!roomCode.trim() || roomCode.length !== 6) {
      alert("올바른 방 코드를 입력해주세요.");
      return;
    }

    try {
      await checkRoomValidity(roomCode);
      sessionStorage.setItem("entryType", "join");
      sessionStorage.setItem("roomCode", roomCode);
      setShowJoinConsent(true);
    } catch (err) {
      alert("유효하지 않은 방 코드입니다.");
    }
  };

  return (
    <div>
      {/* 모달에서 동의 시 네비게이션 */}
      <EntryConsentModal
        isOpen={showJoinConsent}
        onAgree={() => {
          setShowJoinConsent(false);
          navigate("/waiting"); // roomCode는 sessionStorage에서 읽음
        }}
        onDecline={() => setShowJoinConsent(false)}
      />
    </div>
  );
};
```

### 배운 점

- `useNavigate`로 프로그래밍 방식의 라우팅 가능
- 세션 스토리지로 라우팅 간 데이터 전달
- 모달 확인 후 자동 네비게이션으로 UX 향상

## 조건부 라우팅과 네비게이션 가드

### useNavigationPrompt 훅 활용

- 녹화 중 실수로 페이지를 벗어나는 것을 방지
- 뒤로가기나 새로고침 시 확인 모달 표시

```jsx
// useNavigationPrompt.js
export function useNavigationPrompt(when, confirmFn) {
  const navigate = useNavigate();
  const location = useLocation();

  useEffect(() => {
    if (!when) return;

    // 뒤로가기 방지용 푸시스테이트
    window.history.pushState(null, "", window.location.pathname);

    const handlePopState = async (e) => {
      const confirmed = await confirmFn();
      if (!confirmed) {
        navigate(location.pathname, { replace: true });
        window.history.pushState(null, "", location.pathname);
      }
    };

    window.addEventListener("popstate", handlePopState);
    return () => window.removeEventListener("popstate", handlePopState);
  }, [when, confirmFn, location.pathname]);
}
```

### RecordingRoom에서 사용

```jsx
const RecordingRoom = () => {
  const { isModalOpen, handleConfirm, handleCancel } =
    useNavigationPromptWithModal(true);

  const handleConfirm = async () => {
    leaveRoom();
    navigate("/");
    rawConfirm();
  };

  // 컴포넌트 내에서 확인 모달 렌더링
  return (
    <Modal isOpen={isModalOpen} onClose={handleCancel}>
      <h2>정말 나가시겠습니까?</h2>
      <Button onClick={handleConfirm}>나가기</Button>
    </Modal>
  );
};
```

### 배운 점

- 브라우저의 뒤로가기를 감지하고 제어 가능
- `history.pushState()`로 브라우저 히스토리 조작
- 사용자 의도하지 않은 페이지 이탈 방지로 데이터 보호
-
